
// Simulation of Yahoo Finance fetch
const pkg = require('yahoo-finance2');
let yf;
if (typeof pkg.default === 'function') {
    yf = new pkg.default();
} else if (typeof pkg === 'function') {
    yf = new pkg();
} else {
    yf = pkg.default || pkg;
}

const symbol = "NET";
const date = "2026-02-10";

async function testYahoo() {
    console.log(`=== Testing Yahoo Finance for ${symbol} on ${date} ===`);
    try {
        const queryDate = new Date(date);
        const fromDate = new Date(queryDate);
        fromDate.setDate(fromDate.getDate() - 2);
        const toDate = new Date(queryDate);
        toDate.setDate(toDate.getDate() + 2);

        const queryOptions = {
            period1: fromDate.toISOString().slice(0, 10),
            period2: toDate.toISOString().slice(0, 10),
        };

        console.log(`Query options: ${JSON.stringify(queryOptions)}`);
        const result = await yf.historical(symbol, queryOptions);

        console.log("Response (first 2 items):");
        console.log(JSON.stringify(result.slice(0, 2), null, 2));

        const target = result.find((it) => {
            const d = new Date(it.date);
            const y = d.getUTCFullYear();
            const m = String(d.getUTCMonth() + 1).padStart(2, '0');
            const da = String(d.getUTCDate()).padStart(2, '0');
            return `${y}-${m}-${da}` === date;
        });

        if (target) {
            console.log(`[FOUND] ${date}: close=${target.close}`);
        } else {
            console.log(`[NOT FOUND] ${date} in result set.`);
        }
    } catch (e) {
        console.error("Yahoo Fetch Failed:", e.message || e);
    }
}

testYahoo();
